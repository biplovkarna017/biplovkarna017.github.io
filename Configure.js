!function(){let e=[],t=[],l=[],n=[],a=[];tableau.extensions.initializeDialogAsync().then(()=>{let r=tableau.extensions.dashboardContent.dashboard,d=tableau.extensions.settings.get("config");d&&(l=JSON.parse(d));let o={};r.getParametersAsync().then(d=>{d.forEach(e=>{t.push(e.name)});let s=[];r.worksheets.forEach(e=>{s.push(e.getFiltersAsync().then(t=>(t.forEach(t=>{o[t.fieldName]=e.name}),t)))}),Promise.all(s).then(d=>{d.forEach(t=>{t.forEach(t=>{e.push(t.fieldName)})});let s=document.getElementById("dropdown-container"),i=document.getElementById("add-dropdown"),p=document.getElementById("save-settings"),c=(e,t,l=[],n="")=>{let a=document.createDocumentFragment(),r=document.createElement("option");r.value="",r.textContent="Select an option",a.appendChild(r),t.filter(e=>!l.includes(e)).forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),e.innerHTML="",e.appendChild(a),n&&(e.value=n)},h=e=>Array.from(s.querySelectorAll(e)).map(e=>e.value).filter(e=>""!==e),u=()=>{let l=h(".key-dropdown"),n=h(".value-dropdown"),a=s.querySelectorAll(".key-dropdown").length,r=s.querySelectorAll(".value-dropdown").length;i.disabled=l.length!==a||n.length!==r||l.length===e.length||n.length===t.length,p.disabled=!!i.disabled},m=(e,t,l,n)=>{let a=document.createElement("select");return a.className=e,c(a,t,l,n),a.addEventListener("change",y(g,100)),a},g=()=>{let l=h(".key-dropdown"),n=h(".value-dropdown"),a=(e,t,l)=>{s.querySelectorAll(e).forEach(e=>{let n=e.value;c(e,t,l.filter(e=>e!==n)),e.value=n})};a(".key-dropdown",e,l),a(".value-dropdown",t,n),u()},f=(d="",c="",f=!1)=>{let y=document.createElement("div");y.className="dropdown-wrapper";let E=e=>{let t=document.createElement("label");return t.textContent=e,t},v=(e,t,l,n,a)=>{let r=document.createElement("div");return r.className="dropdown-label",r.appendChild(E(e)),r.appendChild(m(t,l,n,a)),r};n=h(".key-dropdown"),a=h(".value-dropdown"),l.forEach(e=>{e.filter!=d&&(n.push(e.filter),a.push(e.param))}),n=[...new Set(n)],a=[...new Set(a)];let w=document.createElement("label");w.className="toggle-container";let k=document.createElement("input");k.type="checkbox",k.class="toggleCheckbox",k.checked=f;let C=document.createElement("span");C.className="slider",w.appendChild(k),w.appendChild(C),y.appendChild(w),y.appendChild(v("Filter","key-dropdown",e,n,d)),y.appendChild(v("Parameter","value-dropdown",t,a,c));let A=document.createElement("span");A.className="delete-button",A.textContent="❌",A.addEventListener("click",()=>{y.remove(),l=l.filter(e=>e.filter!==d),g()}),y.appendChild(A),s.insertBefore(y,i),u(),p.addEventListener("click",()=>{let e=h(".key-dropdown"),t=h(".value-dropdown"),l=Array.from(document.querySelectorAll('input[type="checkbox"]')).map(e=>e.checked),n=e.map((e,n)=>r.worksheets.find(t=>t.name===o[e]).getFiltersAsync().then(a=>{let d=a.find(t=>t.fieldName===e);if(!d)return{filter:e,param:t[n],sheet:o[e],allValues:l[n]};{let s;return d.isAllSelected?l[n]?d.getDomainAsync(tableau.FilterDomainType.RELEVANT).then(e=>{s=e.values.map(e=>e.value).join("|")}):s=".*":s=0===d.appliedValues.length?"^$":d.appliedValues.map(e=>e.value).join("|"),r.getParametersAsync().then(a=>{let r=a.find(e=>e.name===t[n]);return r?r.changeValueAsync(s).then(()=>({filter:e,param:t[n],sheet:o[e],allValues:l[n]})):{filter:e,param:t[n],sheet:o[e],allValues:l[n]}})}}));Promise.all(n).then(e=>{tableau.extensions.settings.set("config",JSON.stringify(e)),tableau.extensions.settings.saveAsync().then(()=>{tableau.extensions.ui.closeDialog("Settings saved")})})})},y=(e,t)=>{let l;return function(...n){clearTimeout(l),l=setTimeout(()=>e.apply(this,n),t)}};0!=l.length?l.forEach(e=>f(e.filter,e.param,e.allValues)):f(),i.addEventListener("click",()=>{l=[],f()})})})})}();